import{j as x,p as B,r,q as m,c as u,a as e,F as D,l as E,m as c,s as p,v as _,x as f,o as i,k as C,t as h,_ as S}from"./Dv50Am8a.js";const $=""+new URL("logo.-WuqbNl4.png",import.meta.url).href,z={class:"message-page"},I={class:"message-list"},N={class:"message-header"},V=["src"],A={class:"user-info"},F={class:"username"},L={class:"date"},M={class:"message-content"},U=["onClick"],q={class:"message-form"},O=x({__name:"message",setup(P){const{decodeToken:y,token:d}=B(),k=r(!!d.value),o=r([{id:0,author:"小天使",createTime:"2025-01-01 00:00:00",content:"祝你们永远幸福快乐！"}]),t=r(""),s=r(""),b=r(o.value[o.value.length-1]?.id||0),w=async()=>{if(s.value.length<1||t.value.length<5||t.value.length>200||s.value.length>10)return alert("名字或留言再写多一些吧!");const{data:l}=await m("/api/public/message",{method:"POST",body:{author:s.value,content:t.value},watch:!1},"$oJBmcm9EmD");if(l.value?.code!=200)return alert("等几分钟后再留下你的祝福吧!");o.value.unshift({id:b.value+1,author:s.value,content:t.value,createTime:new Date().toISOString().slice(0,19).replace("T"," ")}),t.value=s.value="",alert("我们已经收到了你的祝福!")};(async()=>{const{data:l}=await m("/api/public/message",{method:"GET",watch:!1},"$0yvoYBlKl0");l.value?.data.length<=0||(o.value=[...l.value.data].reverse())})();const T=async l=>{const n=y(),a={};if(d.value&&(a.Authorization=`Bearer ${d.value}`),!n)return alert("请先登录!");const{data:v}=await m("/api/private/message",{method:"DELETE",body:{id:l},headers:a,watch:!1},"$-zS-XdPN77");if(v.value?.code!=200)return alert("删除留言失败!");o.value=o.value.filter(g=>g.id!==l),alert("删除留言成功!")};return(l,n)=>(i(),u("div",z,[e("div",I,[(i(!0),u(D,null,E(c(o),(a,v)=>(i(),u("div",{key:v,class:"message-item"},[e("div",N,[e("img",{src:c($),alt:"Avatar",class:"avatar"},null,8,V),e("div",A,[e("span",F,h(a.author),1),e("small",L,h(a.createTime),1)])]),e("div",M,[e("p",null,h(a.content),1)]),c(k)?(i(),u("button",{key:0,onClick:g=>T(a.id)},"删除",8,U)):C("",!0)]))),128))]),e("div",q,[p(e("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=a=>f(s)?s.value=a:null),placeholder:"留下你的名字",class:"username",maxlength:"10"},null,512),[[_,c(s),void 0,{lazy:!0}]]),p(e("textarea",{"onUpdate:modelValue":n[1]||(n[1]=a=>f(t)?t.value=a:null),placeholder:"写下你的祝福和鼓励",maxlength:"200"},null,512),[[_,c(t),void 0,{lazy:!0}]]),e("button",{onClick:w},"发送")])]))}}),j=S(O,[["__scopeId","data-v-b85fb8d2"]]);export{j as default};
